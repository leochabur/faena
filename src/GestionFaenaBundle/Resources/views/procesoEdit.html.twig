{% extends "FOSUserBundle::layout.html.twig" %}
        

{% block fos_user_content %}
<br>
<hr>
<span class="h5 card-title">Editar proceso</span>
<hr>

	

	    <p class="h4 mb-4 text-center">{{ proccess.nombre }}</p>
		<div class="row mt-4">
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Reporta articulos a...
				  </div>
				  <div class="card-body">
					<table class="table table-striped table-bordered table-hover table-sm ">
								<thead>
									<tr>
										<th>Proceso Destino</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
					  	{% for send in proccess.procesosDestino %}
					  	  <tr>
								<td>{{ send.nombre }}</td>
						  		<td><a href="{{ path('delete_destination', {origen : proccess.id, destino : send.id}) }}" class="btn btn-sm btn-danger col">Quitar</a></td>
					  	  </tr>
						  
						{% endfor %}	
						</tbody>
						</table>		
						<button type="button" class="btn btn-primary col-6" data-toggle="modal" data-target="#modalSubscriptionForm">Agregar proceso</button>		
				  </div>
				  
				  </div>
		  </div>
		
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				    Configurar manejo stock
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
								<thead>
									<tr>
										<th>Articulo</th>
										<th>Atributo</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									{% for proceso in proccess.manejosStock %}
										<tr>
											<td>{{ proceso.articulo }}</td>
											<td>{{ proceso.atributo }}</td>
											<td class="text-center"><a href="{{ path('bd_delete_manejo_stock_from_proccess', {proccess : proccess.id, manejo : proceso.id}) }}" class="btn btn-sm btn-danger">Quitar</a></td>
										</tr>
									{% endfor %}
								</tbody>
						</table>
				  	{{ form_start(stock) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(stock.articulo, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col">
				  				{{ form_widget(stock.atributo, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col">
				  				{{ form_widget(stock.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	
				  	{{ form_end(stock) }}
				  </div>
				</div>
			</div>
		</div>


		<div class="row mt-4">
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Ajusta movimiento
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
									<thead>
										<tr>
											<th>Articulo</th>
											<th>Tipo Movimiento</th>
											<th>Concepto Movimiento</th>
											<th>Factor Ajuste</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										{% for aj in proccess.ajustes %}
											<tr>
												<td>{{ aj.articulo }}</td>
												<td>{{ aj.tipoMovimiento }}</td>
												<td>{{ aj.conceptoMovimiento }}</td>
												<td>{{ aj.factorAjuste }}</td>
												<td>
													<td class="text-center"><a href="{{ path('bd_edit_procesos_delete_ajuste', {ajuste : aj.id}) }}" class="btn btn-sm btn-danger">-</a></td>
												</td>
											</tr>
										{% endfor %}
									</tbody>
						</table>
				  	{{ form_start(ajuste) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(ajuste.proceso, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  		</div>
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(ajuste.tipoMovimiento, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col">
				  				{{ form_widget(ajuste.conceptoMovimiento, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-2">
				  				{{ form_widget(ajuste.articulo, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-2">
				  				{{ form_widget(ajuste.factorAjuste, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-1">
				  				{{ form_widget(ajuste.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	
				  	{{ form_end(ajuste) }}		
	
				  </div>
				  
				  </div>
		  </div>
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Movimientos Automaticos
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
									<thead>
										<tr>
											<th>Definicion</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										{% for aj in proccess.automaticos %}
											<tr>
												<td>{{ aj.vistaEdicion }}</td>
												<td><a href="{{ path('bd_edit_procesos_delete_automatic', {proccess : proccess.id, concepto : aj.id }) }}" class="btn btn-sm btn-warning">-</a></td>
											</tr>
										{% endfor %}
									</tbody>
						</table>
				  	{{ form_start(auto) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(auto.artAtrCon, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-2">
				  				{{ form_widget(auto.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	
				  	{{ form_end(auto) }}		
	
				  </div>
				  
				  </div>
		  </div>
		</div>
		<div class="row mt-4">
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Proceso destino defecto..
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
									<thead>
										<tr>
											<th>Proceso</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										{% if proccess.procesosDestinoDefault is defined %}
											<tr>
												<td>{{ proccess.procesosDestinoDefault}}</td>
												
													<td class="text-center"><a href="{{ path('bd_delete_proceso_default', {proc : proccess.id}) }}" class="btn btn-sm btn-danger">-</a></td>
												
											</tr>
										{% endif %}
									</tbody>
						</table>
				  	{{ form_start(default) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(default.proceso, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-1">
				  				{{ form_widget(default.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	{{ form_end(default) }}		
	
				  </div>
				  
				  </div>
		  </div>
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Definir articulo base
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
									<thead>
										<tr>
											<th>Articulo</th>
											<th></th>
										</tr>
									</thead>
									<tbody>

											<tr>
												<td>{{ proccess.articuloBase}}</td>
												
													<td class="text-center"><a href="{{ path('bd_delete_proceso_default', {proc : proccess.id}) }}" class="btn btn-sm btn-danger">-</a></td>												
											</tr>
									</tbody>
						</table>
				  	{{ form_start(base) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(base.articulo, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-lg-2">
				  				{{ form_widget(base.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	{{ form_end(base) }}		
	
				  </div>
				  
				  </div>
		  </div>
	</div>
 	<!--        -->
 		<div class="row mt-4">
		  <div class="col-6">
				<div class="card">
				  <div class="card-header">
				     Atributo Base
				  </div>
				  <div class="card-body">
						<table class="table table-striped table-bordered table-hover table-sm ">
									<thead>
										<tr>
											<th>Atributo</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
											<tr>
												<td>{{ proccess.atributoAbstractoBase}}</td>
												
													<td class="text-center"><a href="{{ path('bd_delete_proceso_default', {proc : proccess.id}) }}" class="btn btn-sm btn-danger">-</a></td>
												
											</tr>
									</tbody>
						</table>
				  	{{ form_start(atrBase) }}
				  		<div class="form-row align-items-center">
				  			<div class="col">
				  				{{ form_widget(atrBase.atributo, {'attr' : {'class' : 'form-control-sm'}}) }}
				  			</div>
				  			<div class="col-1">
				  				{{ form_widget(atrBase.asignar, {'attr' : {'class' : 'btn btn-sm btn-success btn-block'}}) }}
				  			</div>
				  		</div>
				  	{{ form_end(atrBase) }}		
	
				  </div>
				  
				  </div>
		  </div>
	</div>
<div class="modal fade" id="modalSubscriptionForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Agregar proceso destino</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
			{{ form_start(form, {'attr': {'class': 'sender'}}) }}
			{{ form_widget(form) }}
			{{ form_end(form) }}
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="viewArticle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Detalle Articulo</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3 modal-body-article">

      </div>
    </div>
  </div>
</div>
{% endblock fos_user_content %}

{% block javascripts %}

<script type="text/javascript">
	$('.view-art').click(function(){
									var url = "{{ path('bd_view_art_proc_fan', {'articulo' : 'id_article'}) }}"; 
									url = url.replace('id_article', $(this).data('id'));
									$('.modal-body-article').load(url);
									$('#viewArticle').modal('show');
	});

	$('.sender').submit(function (event){
										 event.preventDefault();
										 var form = $(this);
										 $.post(form.attr('action'),
										 		form.serialize(),
										 		function(data){
										 						if (data.status)
										 						{
										 							location.reload();
										 						}
										 						else
										 						{

										 						}


										 		});
										
	});
</script>

{% endblock %}
